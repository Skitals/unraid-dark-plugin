Menu="UserPreferences"
Title="Dark Theme"
Icon="bolt"
---
<?

$syslinux = exec("cat /proc/cmdline | grep 'pti=off'");
$theme = exec("cat /proc/cmdline | grep 'spectre_v2=off'");
$output = $syslinux | $theme;


?>

<font size='5'><font color='orange'><i class='fa fa-warning'></i></font>&nbsp;&nbsp;Disabling Spectre, Meltdown and Zombieload (MDS) mitigations may improve your CPU speed.  But these are security risks for certain workloads, and disabling the mitigations is purely all at your own risk.</font>
<br><br><br>
<font size='3'>
<?

	if ($output)
		echo "<font color='orange'>Dark Theme currently disabled</font>";
	else
		echo "<font color='green'>Dark Theme currently enabled</font>";
}
?>
<br><br>
</font>

<?if ($output):?>
<input type='button' onclick='$(this).hide();enableDark();' value='Enable Dark Theme'>
<?else:?>
<input type='button' onclick='$(this).hide();disableDark();' value='Disable Dark Theme'>
<?endif;?>
<script>
$(function() {
	if ( typeof caPluginUpdateCheck === "function" ) {
		caPluginUpdateCheck("disable.security.plg",{name:"Disable Security Mitigations"});
	}
});

function enableDark() {
	$.post("/plugins/disable.security/scripts/enableMitigations.php",{},function(data) {
		if (data) {
			location.reload();
		}
	});
}
function disableDark() {
	$.post("/plugins/disable.security/scripts/disableMitigations.php",{},function(data) {
		if (data) {
			location.reload();
		}
	});
}
</script>



<?
endif;
?>
