Menu="UserPreferences"
Title="Dark Theme"
Icon="file"
---

<?


$theme = exec("cat /boot/config/plugins/dynamix/dynamix.cfg | grep 'theme=\"dark\"'");
$output = $theme;

$lines_array = file("/usr/local/emhttp/plugins/dynamix/styles/default-dark.css");
$search_string = "img{border:none;text-decoration:none;vertical-align:middle;-webkit-filter:grayscale";
foreach($lines_array as $line) {
    if(strpos($line, $search_string) !== false) {
        list(, $new_str) = explode("(", $line);
        // If you don't want the space before the word bong, uncomment the following line.
        $new_str = substr($new_str, 0, strpos($new_str, "%"));
    }
}


?>
<div id="title">Adjust Grayscale</div>
<table><tr>
<td width="250"><iframe src="/plugins/dark.theme/scripts/image.php?grayscale=<? echo $new_str; ?>" height="150" width="225" style="border:none" id="imagesample"></iframe></td>
<td width="100"><input type="range" min="0" max="100" value="<? echo $new_str; ?>" class="slider-color" id="id1"></td>
<td width="100"><span>Value:</span> <span id="f" style="font-weight:bold;color:red"></span></td>
<td width="100"><span style="height:150px;vertical-align: middle;"><input type='button' onclick='refreshImage();' value='Preview'></span></td>
<td width="100"><span><input type='button' onclick='applyGrayscale();' value='Apply Changes'></span></td>
<td width="100"><span id="changes" style="font-weight:bold;color:red"></span></td>
</tr></table>
<div id="title">Enable/Disable Dark Theme</div>
<table><tr>
<?if ($output):?>
<td width="250"></td><td><input type='button' onclick='$(this).hide();disableDark();' value='Disable Dark'></td>
<td><font color='green'>Dark Theme currently enabled</font></td>
<?else:?>
<td width="250"></td><td><input type='button' onclick='$(this).hide();enableDark();' value='Enable Dark'></td>
<td><font color='orange'>Dark Theme currently disabled</font></td>
<?endif;?>
<td><input type='button' onclick='$(this).hide();refreshPage();' value='Refresh'></td>
</tr></table>
<script>
$(function() {
	if ( typeof caPluginUpdateCheck === "function" ) {
		caPluginUpdateCheck("dark.theme.plg",{name:"Dark Theme"});
	}
});

function enableDark() {
	$.post("/plugins/dark.theme/scripts/enableDark.php",{},function(data) {
		if (data) {
			location.reload();
		}
	});
}
function disableDark() {
	$.post("/plugins/dark.theme/scripts/disableDark.php",{},function(data) {
		if (data) {
			location.reload();
		}
	});
}
function refreshPage() {
	location.reload();
}

var slideCol = document.getElementById("id1");
var y = document.getElementById("f");
y.innerHTML = slideCol.value;

slideCol.oninput = function() {
    y.innerHTML = this.value;
}

function refreshImage() {
        document.getElementById('imagesample').src = "/plugins/dark.theme/scripts/image.php?grayscale=" + y.innerHTML;
}

function applyGrayscale() {
            $.ajax({
                type: "GET",
                url: "/plugins/dark.theme/scripts/applyGrayscale.php" ,
                data: { grayscale: y.innerHTML },
                success : function() {
                    document.getElementById("changes").innerHTML = "changes saved (" + y.innerHTML + ")";

                }
            });
        }
</script>
